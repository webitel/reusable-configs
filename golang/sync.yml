definitions:
  template/workflow: &template/workflow
    version: v1.0.5

  template/webitel-wfm: &template/webitel-wfm
    <<: *template/workflow
    name: webitel-wfm
    branch: main
    build:
      binary-name: webitel-wfm
      ldflags: |
        -s -w
        -X github.com/webitel/webitel-wfm/cmd.version=${{ needs.prepare.outputs.version }}-${{ github.run_number }}
        -X github.com/webitel/webitel-wfm/cmd.commit=${{ github.sha }}
        -X github.com/webitel/webitel-wfm/cmd.branch=${{ github.ref_name }}

      package-contents: |
        src=deploy/systemd/${{ vars.SERVICE_NAME }}.service dst=/etc/systemd/system/${{ vars.SERVICE_NAME }}.service type=config

      scripts: |
        preinstall: deploy/debian/preinst.sh
        postinstall: deploy/debian/postinst.sh
        preremove: deploy/debian/prerm.sh

  template/webitel-cases: &template/webitel-cases
    <<: *template/workflow
    name: webitel-cases
    branch: main
    build:
      binary-name: webitel-cases
      ldflags: |
        -s -w

      package-contents: |
        src=deploy/systemd/${{ vars.SERVICE_NAME }}.service dst=/etc/systemd/system/${{ vars.SERVICE_NAME }}.service type=config
        src=example.env dst=/etc/default/${{ vars.SERVICE_NAME }}.env type=config

      scripts: |
        preinstall: deploy/debian/preinst.sh
        postinstall: deploy/debian/postinst.sh
        preremove: deploy/debian/prerm.sh

webitel/webitel-wfm:
  - source: golang/workflows/workflow.yml.njk
    dest: .github/workflows/workflow.yml
    template: *template/webitel-wfm

  - source: golang/workflows/pull-request.yml.njk
    dest: .github/workflows/pull-request.yml
    template: *template/webitel-wfm

  - source: golang/workflows/pull-request-deliver.yml.njk
    dest: .github/workflows/pull-request-deliver.yml
    template: *template/webitel-wfm

webitel/cases:
  - source: golang/workflows/workflow.yml.njk
    dest: .github/workflows/workflow.yml
    template: *template/webitel-cases

  - source: golang/workflows/pull-request.yml.njk
    dest: .github/workflows/pull-request.yml
    template: *template/webitel-cases

  - source: golang/workflows/pull-request-deliver.yml.njk
    dest: .github/workflows/pull-request-deliver.yml
    template: *template/webitel-cases

group:
  - repos: |
      webitel/webitel-wfm
      webitel/cases

    files:
      - source: golang/.idea
        dest: .idea

      - source: golang/.vscode
        dest: .vscode

      - source: golang/configs/.editorconfig
        dest: .editorconfig

      - source: golang/configs/dependabot.yml
        dest: .github/dependabot.yml

      - source: golang/configs/.golangci.yaml
        dest: .golangci.yaml

      - source: golang/configs/.env.otel.example
        dest: .env.otel.example

      - source: golang/workflows/backport-trigger.yml.njk
        dest: .github/workflows/backport-trigger.yml
        template:
          <<: *template/workflow

      - source: golang/workflows/backport.yml.njk
        dest: .github/workflows/backport.yml
        template:
          <<: *template/workflow

      - source: golang/workflows/dependabot-auto-merge.yml
        dest: .github/workflows/dependabot-auto-merge.yml